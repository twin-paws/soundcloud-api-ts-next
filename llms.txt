# soundcloud-api-ts-next

> React hooks and Next.js API route handlers for the SoundCloud API. Client secrets stay on the server.

## What this package does
- Provides 25+ React hooks for accessing SoundCloud data (tracks, users, playlists, search)
- Provides 10 infinite scroll hooks with cursor-based pagination
- Provides secure Next.js API route handlers that keep OAuth credentials server-side
- Provides full OAuth 2.1 authentication with PKCE via `secure.soundcloud.com`
- Provides mutation hooks for authenticated actions (like, follow, repost)
- Built on soundcloud-api-ts

## When to use this package
- Building a Next.js app that needs SoundCloud data
- Building a music discovery or streaming app with React
- Need to search SoundCloud tracks, users, or playlists from a React app
- Need SoundCloud OAuth login in a Next.js app
- Need a SoundCloud audio player in React
- Want typed SoundCloud API access without exposing client secrets to the browser

## When NOT to use this package
- Not using React or Next.js (use soundcloud-api-ts directly instead)
- Building a backend-only service (use soundcloud-api-ts directly)
- Need to download or scrape SoundCloud content (this is an API client, not a scraper)

## Installation
npm install soundcloud-api-ts-next

## Quick Setup
1. Create API routes: import { createSoundCloudRoutes } from "soundcloud-api-ts-next/server"
2. Wrap app with <SoundCloudProvider apiPrefix="/api/soundcloud">
3. Use hooks: useTrack, useTrackSearch, useUser, usePlaylist, usePlayer, etc.

## Key Exports (from "soundcloud-api-ts-next")
### Hooks - General
- useResolve(url) — resolve a SoundCloud URL to a track, user, or playlist

### Hooks - Tracks
- useTrack(trackId) — fetch single track
- useTrackSearch(query) — search tracks
- useTrackComments(trackId) — track comments
- useTrackLikes(trackId) — users who liked track
- useRelatedTracks(trackId) — related tracks
- usePlayer(streamUrl) — audio player with play/pause/seek

### Hooks - Users
- useUser(userId) — fetch single user
- useUserSearch(query) — search users
- useUserTracks(userId) — user's tracks
- useUserPlaylists(userId) — user's playlists
- useUserLikes(userId) — user's liked tracks
- useUserFollowers(userId) — user's followers
- useUserFollowings(userId) — user's followings

### Hooks - Playlists
- usePlaylist(playlistId) — fetch single playlist
- usePlaylistSearch(query) — search playlists
- usePlaylistTracks(playlistId) — playlist tracks

### Hooks - Infinite Scroll
All return { data: T[], loading, error, hasMore, loadMore, reset }
- useInfiniteTrackSearch, useInfiniteUserSearch, useInfinitePlaylistSearch
- useInfiniteUserTracks, useInfiniteUserPlaylists, useInfiniteUserLikes
- useInfiniteUserFollowers, useInfiniteUserFollowings
- useInfiniteTrackComments, useInfinitePlaylistTracks

### Hooks - Authentication
- useSCAuth() — { isAuthenticated, user, login, logout, handleCallback }
- useMe() — current user profile
- useMeTracks() — your tracks
- useMeLikes() — your liked tracks
- useMePlaylists() — your playlists
- useMeFollowings() — who you follow
- useMeFollowers() — your followers

### Hooks - Actions (authenticated)
- useLike() — { likeTrack(id), unlikeTrack(id) }
- useFollow() — { follow(userId), unfollow(userId) }
- useRepost() — { repostTrack(id), unrepostTrack(id) }

### Provider
- SoundCloudProvider — wraps app, configures API route prefix

## Key Exports (from "soundcloud-api-ts-next/server")
- createSoundCloudRoutes({ clientId, clientSecret, redirectUri?, getToken?, onRouteComplete?, onRequest? }) — creates route handlers
  - getToken: optional async function returning a token string (for custom token stores like Redis)
  - onRouteComplete: optional callback receiving SCRouteTelemetry { route, method, durationMs, status, error? } after every route
  - onRequest: optional callback receiving SCRequestTelemetry (from soundcloud-api-ts) for per-SC-API-call telemetry
  - .handler() — App Router catch-all (assign to GET, POST, DELETE)
  - .pagesHandler() — Pages Router catch-all
  - .resolveUrl(url) — resolve a SoundCloud URL server-side
  - .searchTracks(q), .getTrack(id), .getUser(id), etc. — individual methods
- createSCAuthManager({ clientId, clientSecret, redirectUri }) — creates a stateful PKCE auth manager for programmatic OAuth flows
  - Use when you need custom logic after token exchange (user creation, JWT minting, account linking)
  - .initLogin() → Promise<{ url, state }> — generates PKCE verifier/challenge + CSRF state, returns SC authorize URL. Verifier stored in-memory.
  - .exchangeCode(code, state) → Promise<SoundCloudToken> — verifies CSRF state, exchanges code + PKCE verifier for tokens (one-time use)
  - .refreshToken(refreshToken) → Promise<SoundCloudToken> — refresh an expired access token
  - .pendingLogins → number — active PKCE entry count (for observability)
- SCAuthManager — the class returned by createSCAuthManager (use the factory, not the constructor directly)
- Types: SCAuthManagerConfig, SCLoginResult, SoundCloudToken

## All hooks return
{ data: T | null, loading: boolean, error: Error | null }

## TypeScript types (re-exported from soundcloud-api-ts)
SoundCloudTrack, SoundCloudUser, SoundCloudPlaylist, SoundCloudComment, SoundCloudStreams, SoundCloudToken, SCRouteTelemetry, SCRequestTelemetry

## Underlying client (soundcloud-api-ts v1.13.0+)

This package depends on soundcloud-api-ts ^1.13.0. New capabilities available via the raw client and config:

```ts
// Pass advanced options through createSoundCloudRoutes → forwarded to SoundCloudClient
createSoundCloudRoutes({
  clientId, clientSecret, redirectUri,
  fetch: customFetch,           // custom fetch (Workers, Bun, Deno)
  dedupe: true,                 // default on — dedupes concurrent identical GETs
  cache: myCache,               // SoundCloudCache interface — plug in any backend
  cacheTtlMs: 30_000,
  onRetry: (info) => logger.warn('SC retry', info),
})
```

New endpoints available via route handlers and hooks (auto-wired):
- `sc.tracks.getTracks(ids[])` — batch fetch multiple tracks
- `sc.me.getConnections()` — linked social accounts
- `sc.raw.get('/any/endpoint/{id}', params)` — escape hatch for any spec endpoint

Auth: see `docs/auth-guide.md` in soundcloud-api-ts for `TokenProvider`/`TokenStore` patterns.

## Related packages
- soundcloud-api-ts — TypeScript-first SoundCloud API client (dependency, v1.13.0+)

## Links
- npm: https://www.npmjs.com/package/soundcloud-api-ts-next
- GitHub: https://github.com/twin-paws/soundcloud-api-ts-next
- API client: https://github.com/twin-paws/soundcloud-api-ts
